os: windows
language: shell

env:
  global:
    - GOVERSION: 1.11.5
    - NODEJS_VERSION: 11.9.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh
  - set

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: btdGKk1vd0ADM0bznbIAQ7MY6dKijXGUJjzy0+nWPUokRT3dvmBTSVInODctkFKM2q3UBzTbW/+b+zCyBwlIxmjZvtnR8sUDyv7SVYA/P+YK5dnnRKCD16hD49R/IhUKhviDjoF3stMgkOHOSh0eL89f61TQ9DEOtrgKfdZd9jAHLAZtcQrFZ7s6a3P9H4Ptfg7bM8431aCPvQjP5ELxZ0FWsXj6NL0BsWeC7tsuf+YBlQV/4QkevLThNaJcGWoSGEHi5iA0B1+7v36mXaiCB7y05O2/Npd5wwpyqM6+TTCgCIbZGju9IaPF32oyK5trWww/+0PqLLvQFeCgVFEdxmEls9pBColrLmsmfJmkbVjlQIxt5e/30dGVWr1hSKa9fSejAZfqhs8ZKv6UIRzJ7On1BSKp21zFflIoGzgk/vpvEizK2lRagFTjhO1CkBPWGZST4wsHYlTfQH+gpWHycbwvnGoWLx4rWxqh2CGMycVACwm6RUygs3969Fxq/rRf+K8Ec8hL3XgmGZtBSWbMpVN2Y8gzv3hkNFwes+LLZ2ANCCfXveJuKMsWvxGqtBXxF273vdtUPw/BH+Adcbo0hM9iMzqKa2dBeoSXS4E6Hxf5TWyM/UYMhLv3DiTiFylqb2IYHZ9miWKC5/u5j5gA8HxHCQD+YPhHGkczMMBNZtk=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false
